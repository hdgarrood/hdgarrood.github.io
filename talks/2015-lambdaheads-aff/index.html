<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <script type="text/javascript" src="reveal.js"></script>
    <link rel="stylesheet" type="text/css" href="reveal.css">
    <link rel="stylesheet" type="text/css" href="style.css">
    <title>Dealing with asynchronous-ness in PureScript</title>
  </head>
  <body>
    <div class="reveal">
      <div class="slides">
        <section id="title">
          <h1>Dealing with asynchronous-ness in PureScript</h1>
          <h3>Harry Garrood</h3>
        </section>

        <section id="overview">
          <h1>Overview</h1>
          <ol>
            <li>IO without side effects</li>
            <li>Quick introduction to PureScript</li>
            <li>Asynchronous IO in PureScript</li>
          </ol>
        </section>

        <section id="io-without-side-effects">
          <section id="side-effects">
            <h1>Side effects</h1>
            <ul>
              <li>Any communication a function performs with the rest of the
                program (or the outside world) other than its parameters or
                return value.</li>
            </ul>
<pre><code>printf("Hello world!\n");
read_file("foo.txt");
rand();</code></pre>

            <ul>
              <li>Why avoid side effects?</li>
            </ul>
          </section>

          <section id="performing-io">
            <h1>Representing IO without side-effects</h1>
            <ul>
              <li>A data type for representations of IO actions</li>
            </ul>
<pre><code>printf    -&gt; putStrLn  :: String -> IO ()
read_file -&gt; readFile  :: String -> IO String
rand      -&gt; getRandom :: IO Int</code></pre>
          </section>

          <section id="putting-io-actions-together">
            <h1>Putting IO actions together</h1>
<pre><code>(>>=)  :: IO a -> (a -> IO b) -> IO b
return :: a -> IO a

getLine >>= putStrLn

forM :: [a] -> (a -> IO b) -> IO [b]

forM [1,2,3] $ \x -> putStrLn ("x is: " ++ show x)</code></pre>
          </section>
        </section>

        <section id="purescript-intro">
          <section id="purescript">
            <h1>PureScript</h1>
<pre><code>module Main where

import Prelude
import Control.Monad.Eff.Console (log)

greet :: String -> String
greet name = "Hello, " ++ name ++ "!"

main = log (greet "World")</code></pre>
          </section>

          <section id="eff">
            <h1>IO =~ Eff</h1>
<pre><code>log :: String -> Eff _ Unit

function log(message) {
  return function() {
    console.log(message)
    return {}
  }
}</code></pre>
        </section>
      </section>

      <section id="section-3">
        <section id="limitations-of-eff">
          <h1>Limitations of Eff</h1>
          <ul>
            <li>Synchronous</li>
          </ul>
          <pre><code>httpGet :: String -&gt; Eff _ HttpResponse</code></pre>
          <ul>
            <li>Callbacks</li>
          </ul>
          <pre><code>httpGet :: String
            -&gt; (HttpResponse -&gt; Eff _ Unit)
            -&gt; Eff _ Unit</code></pre>
        </section>

        <section id="callbacks">
          <h1>Limitations of callbacks</h1>
  <pre><code>main =
  getLine (\inputFile -&gt; do
    log ("Reading: " ++ inputFile)
    readFile inputFile (\json -&gt;
      case parseJson json of
        Left err -&gt;
          throw err
        Right data -&gt;
          httpPost url data (\response -&gt;
            log response.body)))</code></pre>
        </section>

        <section id="asynchronous-actions">
          <h1>Asynchronous actions</h1>
<pre><code>program :: Aff _ Unit
program = do
  inputFile &lt;- getLine
  log ("Reading: " ++ inputFile)
  json &lt;- readFile inputFile
  case parseJson json of
    Left err -&gt;
      throw err
    Right data -&gt; do
      response &lt;- httpPost url data
      log response.body

main = launchAff program</code></pre>
          </section>
        </section>
      </div>
    </div>

    <script type="text/javascript">
      Reveal.initialize({
          history: true,
      })
    </script>
  </body>
</html>
